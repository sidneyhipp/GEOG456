<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet with Proportional Symbols</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js" integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ==" crossorigin=""></script>
    <style>
        #map { height: 400px; width: 900px; background-color: lightslategray; text-align: center; }
    </style>
</head>
<body>
    <h1>Annual Residential Water Use in Austin, Texas</h1>
    <h2 id="theYear">Year</h2>
    <input type="range" name="year" value="2012" min="2012" max="2020" oninput="moveSlider(this.value)">
    <div id="map"></div>
    <script>
        var map = L.map('map').setView([30.293322656220493, -97.74882492684549], 10);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Â© OpenStreetMap'
        }).addTo(map);

        var selectedYear = '2012';
        var markers = [];

        function createMarkers(data) {
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];

            data.forEach(location => {
                var marker = L.circleMarker([location.lat, location.lng], {
                    radius: calculateRadius(location[selectedYear]),
                    color: 'black',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.7
                }).addTo(map);

                markers.push(marker);
            });
        }

        function calculateRadius(value) {
            // Adjust this calculation based on your data to determine marker size
            return Math.sqrt(value) * 2;
        }

        function moveSlider(value) {
            selectedYear = value;
            document.getElementById('theYear').innerHTML = 'Year: ' + value;
            createMarkers(aws.features.map(feature => ({
                lat: feature.geometry.coordinates[1],
                lng: feature.geometry.coordinates[0],
                [selectedYear]: feature.properties[selectedYear]
            })));
        }

        moveSlider('2012');
    </script>
</body>
</html>
